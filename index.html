<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
    
    <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
    <script>
        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(addPosition);
          } else {
            alert( "Geolocation is not supported by this browser.");
          }
        }
  
        function addPosition(position) {
          
          alert(position.coords.longitude);
          alert(position.coords.latitude);
          //let animal = document.getElementById("animal")
          //animal.setAttribute('gps-entity-place',"longitude: "+position.coords.longitude+"; latitude: "+position.coords.latitude)
        }
  
      </script>
    
    
    <script>
        // catAnimations = ['IdleNorm', 'WalkCycle', 'IdleTailSwoosh', 'SitDown', 'IdleSit', 'StandUp']
        // dogAnimations = ['Idle1', 'WalkCycle', 'IdleTailSwoosh', 'SitDown', 'IdleSit', 'StandUp', 'RunCycle','SitScratchEar',  'LayDown', 'SitUp', 'StandUp', 'IdleEarTwitch', 'Jump']
        // horseAnimations = ['Idle1' ]

        // commands=["run", "stand", "sit", "walk"]

        // function spawn(animal){
        //     var el = document.querySelector("#animal");
        //     el.setAttribute("visible", "false")
        //     setTimeout(()=>{showAnimal(el, animal)}, 10);
            
        //     //EventListener
        //     el.addEventListener('animation-finished', (event)=>{
        //         let idleAnimation
        //         if(animal=="models/horse/scene.gltf")
        //         {
        //             idleAnimation = horseAnimations[0]
        //         }
        //         else if(animal=="models/dog/scene.gltf")
        //         {
        //             idleAnimation = dogAnimations[0]
        //         }
        //         else if(animal=="models/cat/scene.gltf")
        //         {
        //             idleAnimation = catAnimations[0]
        //         }
        //         animationMixer = "clip:" + idleAnimation
        //         el.setAttribute("animation-Mixer", animationMixer)
        //     });

        // }

        // function showAnimal(el, animal){
        //     if(animal=="models/horse/scene.gltf")
        //     {
        //         animation="property: position;from:270 65 -25; to: 270 65 -105; dur: 2000; easing: linear;";
        //         scale = '0.1 0.1 0.1';
        //         position= '270 65 -25';
        //         animationMixer = "clip:"+ horseAnimations[0]+"; repetitions: 4"
        //         controls= horseAnimations
        //     }
        //     else if(animal=="models/cat/scene.gltf")
        //     {
        //         animation="property: position; from:270 22 -24; to: 270 22 -105; dur: 4000; easing: linear; loop: false"
        //         scale = '1 1 1'
        //         position= '270 22 -25'
        //         animationMixer = "clip:" + catAnimations[1]+"; repetitions: 4"
        //         controls= catAnimations
        //     }
        //     else if(animal=="models/dog/scene.gltf" )
        //     {
        //         animation="property: position; from: 270 22 -25; to: 270 22 -105; dur: 4000; easing: linear; loop: false"
        //         scale = '1 1 1'
        //         position= '270 22 -25'
        //         animationMixer = "clip:"+ dogAnimations[1]+"; repetitions: 4"
        //         controls= dogAnimations
        //     }  
            
        //     // Setting the current Aniamtion property
        //     el.setAttribute("animation-Mixer", animationMixer)
        //     el.setAttribute("scale", scale)
        //     el.setAttribute("position", position)
        //     el.setAttribute("animation", animation)

        //     el.setAttribute("gltf-model", animal)
        //     el.setAttribute("visible", "true")
            
        //     pos= 100
            
        //     animal = document.getElementById('animal')
        //     animal.innerHTML=''

        //     commands.forEach(command => {
        //         var aPlane = document.createElement('a-plane');
        //          aPlane.setAttribute("class", "clickable");
        //          aPlane.setAttribute("color", "black");
        //          aPlane.setAttribute("width", "3");
        //          aPlane.setAttribute("height", "1");
        //          aPlane.setAttribute("position", "0 "+ pos +" -6");
        //          aPlane.setAttribute("scale", "10 10 10");
        //          //aPlane.setAttribute("onclick", "perfomCommand('"+control+"')")
        //          aPlane.setAttribute("onclick", "perfomCommand('"+command+"')")
                    
        //          var aText =  document.createElement('a-text');
        //          aText.setAttribute("Value", command);
        //          aText.setAttribute("position", "-1.2 0 0");
                 
        //         aPlane.appendChild(aText)
        //         animal.appendChild(aPlane)
        //         pos=pos-7
        //     });

        // }

        // function perfomCommand(animation){
        //     var el = document.querySelector("#animal");
        //     if(command=="walk")
        //     {
               
        //     }
        //     animationMixer = "clip:"+ animation +"; repetitions: 1"
        //     el.setAttribute("animation-Mixer", animationMixer)
        // }
        
    window.onload = () => {
        let testEntityAdded = false;
        alert("creating new object")
        const el = document.querySelector("[gps-new-camera]");

        el.addEventListener("gps-camera-update-position", e => {
            if(!testEntityAdded) {
                alert(`Got first GPS position: lon ${e.detail.position.longitude} lat ${e.detail.position.latitude}`);
                // Add a box to the north of the initial GPS position
                const entity = document.createElement("a-box");
                entity.setAttribute("scale", {
                    x: 20, 
                    y: 20,
                    z: 20
                });
                entity.setAttribute('material', { color: 'red' } );
                entity.setAttribute('gps-new-entity-place', {
                    latitude: e.detail.position.latitude + 0.001,
                    longitude: e.detail.position.longitude
                });
                document.querySelector("a-scene").appendChild(entity);
            }
            testEntityAdded = true;
        });
        
        alert("End")
        
        getLocation()
    };
    </script>
    
  </head>
  <body>
    <a-scene  vr-mode-ui="enabled: false"
    embedded
    arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>

        <a-entity
            raycaster="objects: .clickable"
            cursor="rayOrigin: mouse"> 
        </a-entity>
        <a-assets>
            <a-asset-item id="cat" src="models/cat/scene.gltf"></a-asset-item>
            <a-asset-item id="dog" src="models/dog/scene.gltf"></a-asset-item>
            <a-asset-item id="duck" src="models/duck/scene.gltf"></a-asset-item>
            <a-asset-item id="bird" src="models/flying_bird/scene.gltf"></a-asset-item>
            <a-asset-item id="horse" src="models/horse/scene.gltf"></a-asset-item>
            <a-asset-item id="cafe" src="models/cafe_soca/scene.gltf"></a-asset-item>
        </a-assets>
        <!--
        <a-entity environment="preset:forest; lightPosition: 0 1000 0;" ></a-entity>
         -->
         
         <a-camera gps-new-camera='gpsMinDistance: 5'>
        </a-camera> 

            <a-entity position="0 0 0" rotation="0 0 0" >
                <a-plane class="clickable" color="black" width="3" height="1">
                   <a-text value="Select Item from Menu" position="-1.2 0 0"></a-text>
                </a-plane> 
                <a-plane position="0 -0.8 0" class="clickable" color="red" width="3" height="0.5"  onclick="spawn('models/dog/scene.gltf')">
                   <a-text value="Tea" position="-1.2 0 0"></a-text>
                </a-plane> 
                <a-plane position="0 -1.35 0" class="clickable" color="red" width="3" height="0.5"  onclick="spawn('models/cat/scene.gltf')">
                   <a-text value="Coffee" position="-1.2 0 0"></a-text>
                </a-plane> 
                <a-plane position="0 -1.9 0" class="clickable" color="red" width="3" height="0.5"  onclick="spawn('models/horse/scene.gltf')">
                   <a-text value="Juice" position="-1.2 0 0"></a-text>
                </a-plane> 
                
            </a-entity> 
            <!--Model of the animal-->
            <a-entity id="animal" visible="true" gltf-model="#cat" position="0 0 0" rotation="0 0 0" scale="0.1 0.1 0.1" animation-mixer="" >
                
            </a-entity>

    </a-scene>
  </body>
</html>
